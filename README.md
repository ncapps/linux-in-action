# Notes from Linux in Action by David Clinton
## Chapter 1. Welcome to Linux
- Linux basics:
  - the UNIX Filesystem Hierarchy Standard
  - Navigation - `ls pwd cd`
  - File management tools - `cat less touch mkdir rmdir rm cp mv`
  - Tricks - tab completion and file globbing
  - `sudo`
  - Where to find help - `man info journalctl`
- A file system uses an index to provide the appearance of an organized set of directories and files within a single disk division known as a *partition*
- All files in a disk partition are kept in directories between the root directory `/`
```
|--/           Root
|----/etc      Program configuration files
|----/var      Frequently changing content (i.e., log files)
|----/home     User account files
|----/sbin     System binary files
|----/bin      User binary files
|----/lib      Shared libraries
|----/usr      Third-party binaries
```
- The shell interprets the execution of user input commands
- *absolute path* is a path that begins with the root directory
- A pseudo file's contents are dynamically generated by the OS itself to represent specific values
- Linux uses pseudo file systems to expose data on the hardware environment to processes and users

**Key Terms**
- A *file system* is made up of data files indexed in a way that allows the perception of a directory-based organization
- A *process* is an active instance of a running software program
- A *disk partition* is the logical division of a physical storage device that can be made to work exactly like a standalone device. Partitions are common organizational tools for all modern operating systems
- *Bash* is a command-line user interface for executing system actions
- *Plain text* that is usable for administration purposes is text made up of a limited set of characters and contains no extraneous formatting code
- *File globbing* involves using wildcard characters to refer to multiple files with a single command
- *Tab completion* employs the Tab key to suggest possible completions of a partially typed command
- *Pseudo file systems* are directories containing files with dynamic data automatically generated at or after system boot

## Chapter 2. Linux Virtualization: Building a Linux working environment
- *Hypervisors* - Controls host system hardware providing each guest OS the resources it needs. Guest machines are run as system processes with virtualized access to hardware resources.
- *Containers* - Extremely lightweight virtual servers that share the underlying kernel of their host OS.
- *apt* - Advanced Package Tool
- The package manager fulfills the following responsibilities:
  - Maintains a local index to track repositories and their contents
  - Tracks the status of all the software that's installed on your local machine
  - Ensures that all available updates are applied to installed software
  - Ensures that software dependencies are met for new applications before they're installed
  - Handles installing and removing software packages
- The package manager type depends on the Linux distribution
- Run `arch` to check if the operating system is 64-bit or 32-bit
- It's always a good idea to update the repo information before installing new software
- A *dependency* is software that must already be installed on your computer for a new package to work
- Change password with `passwd`

**Summary**
- Hypervisors like VirtualBox provide an environment where virtual operating systems can safely access hardware resources, whereas lightweight containers share their hosts's software kernel
- Linux package managers like APT and RPM (Yum) oversee the installation and administration of software from curated online repositories using a regularly updated index that mirrors the state of the remote repository
- Getting a VM going in VirtualBox requires defining its virtual hardware environment, downloading an OS image, and installing the OS on your VM
- LXC containers are built on predefined, distribution-based templates
- LXC data is stored within the host file system, making it easy to administer containers

**Key Terms**
- *Virtualization* is the logical sharing of compute, storage, and networking resources among multiple processes, allowing each to run as if it was a standalone physical computer
- A *hypervisor* is software running on a host machine that exposes system rsources to a guest layer, allowing the launching and administration of full-stack guest VMs
- A *container* is a VM that shares the host machine's core OS kernal. Containers are fast and easy to launch and kill
- A *software repository* is a location where digital resources can be stored. Repositories are useful for collaboration and distribution of software packages

**Security Best Practices**
- It is preferred to use an official package manager to install and maintain software on your Linux system
- Always scan the checksum hashes of downloaded files against the correct hash strings, packages could be corrupted during download or switched by man-in-the-middle attackers

**Command Line Review**
- `apt install PACKAGE_NAME` installs a software package from a remote repository
- `dpkg -i PACKAGE_NAME` installs a downloaded Debian package on a Ubuntu machine
- `wget FILE_LOCATION` downloads a file
- `apt update` syncs the local software index with what's available from online repositories
- `shasum PACKAGE_NAME` calculates the checksum for a downloaded file
- `ip addr` displays information on each of a system's network interfaces

## Chapter 3. Remote connectivity: Safely accessing networked machines
- An *encryption key* is a small file containing a random sequence of characters
- The key can be applied as part of an encryption algorithm to convert plain-text, readable data into total gibberish
- Using the key on the encrypted version of the file converts the gibberish back to its original form
- The SSH network protocol enables secure communication by encrypting data packets before transmission and decrypting them at the other end
- You can for a process to automatically load on system startup using `systemctl enable PROCESS_NAME` or to not load on startup `systemctl disable PROCESS_NAME`
- Configuration files for most programs can be found in the `/etc/` directory
- An alternative to SSH password authentication is to create a special key pair and then copy the public half of the pair to the remote host
- Copy the public key to the host machine - `cat .ssh/id_rsa.pub ssh ubuntu@10.0.3.142 "cat >> .ssh/authorized_keys"`
- Specify which key pair to use for a session - `ssh -i .ssh/mykey.pem ubuntu@10.0.3.142`
- The SCP program copies files using the SSH protocol for file transfer
- Purpose-built program : `ssh-copy-id`
- *X11 forwarding* allows you to load a host machine-based program in the desktop of your client
- *Software* is programming code containing instructions to control computer hardware on behalf of human users
- A *Process* is an instance of a running software program
- An *operating system* is a tool for organizing and managing those instances/processes to effectively use a computer's hardware resources
- *init* is the first process to wake up and get everything else going when a Linux system boots
- `ps` displays information about active processes, The `-e` flag returns all the processes from all parent shells back up to init
- `pstree -p` visualizes the parent and child processes
- Nearly all Linux distributions use the same process manager: *systemd*. It's a replacement for `/sbin/init`
- The *d* stands for *daemon*, a background system process
- The `systemctl` command is a tool for process management

**Summary**
- Encrypted connections are a critical part of all networked communications. SSH is the industry standard.
- Enable password-free SSH acces by sharing the public key of a key pair
- The OpenSSH package also supports secure file copying and remote graphics
- Processed are managed by *systemd* through the `systemctl` tool for most modern Linux distributions
- Pipe data between commands using `|` and filter streaming data with `grep`

**Key Terms**
- A *password* is a string of regular characters. A *passphrase* can include spaces and punctuation
- *RSA* is a popular encryption algorithm
- *X11 forwarding* allows graphic programs to run over a remote connection
- A Linux *process* is all the ongoing activity that's associated with a single running program
- A *shell* is a terminal environment that provides a command-line interpreter to allow a user to execute commands
- A shell, for all intents and purposes, also a process. A *parent shell* is an initial environment where new child shells can be launched

**Security Best Practices**
- Always encrypt remote login sessions running over a public network
- Avoid relying on passwords alone
- Key-based, passwordess SSH sessions are preferable
- Never transfer files across public networks in plain text

**Command Line Review**
- `dpkg -s PACKAGE_NAME` - checks the status of an APT-based software package
- `systemctl status PROCESS_NAME` - checks the status of a system process
- `systemctl start PROCESS_NAME` - starts a service
- `ip addr` - lists all the network interfaces on a computer
- `ssh-keygen` - generates a new pair of SSH keys
- `cat .ssh/id_rsa.pub ssh ubuntu@10.0.3.142 "cat >> .ssh/authorized_keys"` - copies a local key to a remote machine
- `ssh-copy-id -i .ssh/id_rsa.pub ubuntu@10.0.3.142` - safely copies encryptions keys to a remote machine
- `ssh -i .ssh/mykey.pem ubuntu@10.0.3.142` - specifies a particular key pair
- `scp myfile ubuntu@10.0.3.142:/home/ubuntu/myfile` - safely copies a local file to a remote computer
- `ssh -X ubuntu@10.0.3.142` - allows you to log in to a remote host for a graphics-enabled session.
- `ps -ef | grep init` - displays all currently running system processes and filters results using the string init
- `pstree -p` - displays all currently running system processes in a visual tree format

## Chapter 4. Archive management: Backing up or copying entire file systems
- Archive files and file systems using `tar`
- `c` flag instructs `tar` to create a new archive
- `v` sets the screen output to verbose
- `f` points to the filename that will be given to the archive
- `z` tells the gzip program to compress the archive
- `x` for extract
- Using dot (`.`) instead of asterik (`*`) will include hidden files
- Use the `chmod` tool to change a file's permissions
- File permissions - Read = 4, Write = 2, Execute = 1
- Use `chown` to update the file owner and group
- Archive and extract files using `sudo` to maintain file permissions
- Be very careful with the `dd` command
- Synchronize archives with `rsync`
- The goal is to measure the value of your data against these questions:
  1. How often should you create new archives, how long will you retain old copies?
  2. How many layers of validation will you build into your backup process?
  3. How many concurrent copies of your data will you maintain?
  4. How important is maintaining geographically remote archives?

**Summary**
- The `tar` command is generally used for archiving full or partial file systems, whereas `dd` is more suited for imaging partitions
- Adding compression to an archive not only saves space on storage devices, but also bandwidth during a network transfer
- Directories containing pseudo file systems usually don't need backing up
- You can incorporate the transfer of an archive into the command that generates it, optionally avoding any need to save the archive locally
- You should try to preserve the ownership and permissions attributes of objects restored from an archive
- You can use `dd` to wipe old disks
- You can incrementally synchronize archives using `rsync`, reducing the time and network resources needed for ongoing backups

**Key Terms**
- An *archive* is a specially formatted file in which file system objects are bundled
- *Compression* is a process for reducing the disk space used by a file through the application of a compression algorithm
- An *image* is an archive containing the files and directory structure necessary to re-create a source file system in a new location
- *Permissions* are the attributes assigned to an object that determines who may use it and how
- *Ownership* is the owner and group that have authority over an object
- A *group* is an account used to manage permissions for multiple users

**Security Best Practices**
- Create an automated, reliable, tested, and secure recurring process for backing up all of your important data
- Where appropriate, separate file systems with sensitive data by placing them on their own partitions and mounting them to the file system at boot time
- Ensure that file permissions are accurate, and allow only the least access necessary
- Never assume the data on an old storage drive is truly deleted

**Command Line Review**
- `df -h` displays all currently active partitions with sizes
- `tar czvf archivename.tar.gz /home/myuser/*.txt` creates a compressed archive from text files in a specified directory tree
- `split -b 1G archivename.tar.gz archivename.tar.gz.part` splits a large file into smaller files of a set maximum size
- `cat archivename.tar.gz.part* > archivename.tar.gz` re-creates the archive by reading each of the parts in sequence and then redirect the output to a new file
- `find /var/www/ -iname "*.mp4" -exec tar -rvf videos.tar {} \;` finds files meeting a set criteria and streams their names to `tar` to include in an archive
- `chmod o-r /bin/zcat` removes read permissions for others
- `dd if=/dev/sda2 of=/home/username/partition2.img` creates an image of the sda2 partition and saves it to your home directory
- `dd if=/dev/urandom of=/dev/sda1` overwrites a partition with random characters to obscure the old data

## Chapter 5. Automated administration: Configuring automated offsite backups
- Regular and reliable system backups are absolutely *critical*
- *shebang line* - `#!/bin/sh`
- exit status code of 0 signifies the command was successful
- `cp -p` preserves the source file's original ownership attributes and timestamp
- `adduser USERNAME` to add a user, create a home directory, and set the default password
- AWS's `aws s3 sync` works a lot like `rsync`
- Place files in a `/etc/cron.*` directory for recurring execution
- *anacrontab* is where you schedule operations to run at a set time after each system boot

**Summary**
- Bash scripts can automate administrative tasks
- Linux keeps user account and authentication information in plain text files (named passwd, group, shadow, and gshadow) in the `/etc` directory
- You can back up local data to an S3 bucket. The `aws s3 sync` works very similar to `rsync`
- Copying an executable script to one of the `/etc/cron` directories causes it to be run at the appropriate interval
- Adding a directive to the anacrontab file executes commands relative to system boots, rather than absolute times
- systemd timers can be set to run based on both absolute time and in reaction to system events, like changes to hardware states

**Key Terms**
- All Linux commands output *exit codes* upon completion: 0 represents a successful execution. All positive integers can be a set by a program to represent various failed states
- A *bucket* is an AWS resource that works very similar to a directory on an operating system

**Security Best Practices**
- Lock down your system accounts, i.e., syslog, to prevent their being used for remote logins
- Include off-site backups in your security planning, which adds another layer of data reliability
- Protect access keys, passwords, and encryption key pairs from public exposure

**Command Line Review**
- `#!/bin/bash` - tells Linux which shell interpreter you're going to be using for a script
- `||` inserts an *or* condition into a script. Think of this as either "the command to the left is successful" or "execute the command to the right"
- `&&` inserts an *and* condition into a script. Think of this as "if the command to the left is successful" and "execute the command to the right"
- `test -f /etc/filename` tests for the existence of the specified file or directory name
- `chmod +x upgrade.sh` makes a scrpt file executable
- `aws s3 sync /home/username/dir2backup s3://linux-bucket3040` synchronizes the contents of a local directory with the specified S3 bucket
- `21 5 * * 1 root apt update && apt upgrade` - a cron directive, executes two apt commands at 5:21 each morning
- `NOW=$(date + "%m_%d_%Y")` assigns the current date to a script variable
- `systemctl start site-backup.timer` activates a systemd system timer

## Chapter 6. Emergency tools: Building a system recovery device
- **GNU GRand Unified Bootloader** - code an OS uses to bring itself to life when it's powered on
- Linux boot sequence
  1. System power up
  2. BIOS or UEFI - identifies hardware environment
  3. Mounts MBR - master boot record partition
  4. GRUB - displays menu and executes an image kernel
  5. Kernel - mounts root partition
  6. Hand-off to init or systemd
- A *partition* is really metadata pointing to the location on a physical disk occupied by a file system

**Summary**
- Linux recovery modes provide access to administration tools useful for repairing systems that won't boot normally
- Live-boot drives allow you to boot your choice of Linux distros independently of the file systems on a computer's phyiscal drive
- Purpose-build distros like SystemRescueCd are lightweight versions of Linux that come preinstalled with a full range of rescue tools
 - Damaged partitions can sometimes be restored using tools like TestDisk
 - Data from damaged partitions can sometimes be recovered using tools like ddrescue and PhotoRec
 - File systems can be mounted and administered using a virtual process called `chroot`

 **Key Terms**
 - *GRUB* is a bootloader that manages the images to be used in the Linux boot process
 - A *hash* (checksum) is a cryptographically generated value that can be checked against a master copy to confirm an image's authenticity
 - A partition's *Master Boot Record (MBR)* for a CD will be different than for a USB, additional steps are required for creating live-boot USBs
 - The tool `chroot` opens virtual root shells within the mounted file systems

 **Security Best Practices**
 - Always confirm that downloaded images are authentic by checking their hashes. Avoid downloading from unencrypted websites.
 - Carefully consider where or not to encrypt the data at rest on your system drives. Balance accessibility with security
 - Enforce the use of password vaults and single sign-on services

 **Command-Line Review**
 - `sha256sum systemrescuecd-x86-5.0.2.iso` - calculates the SHA256 checksum of a .ISO file
 - `isohybrid systemrescuecd-x86-5.0.2.iso` -  adds a USB-friendly MBR to a live-boot image
 - `dd bs=4M if=systemrescuecd-x86-5.0.2.iso of=/dev/sdb && sync` - writes a live-boot image to an empty drive
 - `mount /dev/sdc1 /run/temp-directory` - mounts a partition to a directory on the live file system
 - `ddrescue -d /dev/sdc1 /run/usb-mount/sdc1-backup.img /run/usb-mount/ sdc1-backup.logfile` - saves files on a damaged partition to an image named sdc1-backup.img and writes events to a log file.
 - `chroot /run/mountdir/` - opens a root shell on a file system

 ## Chapter 7. Web servers: Building a MediaWiki server
 - *Content Management System (CMS)* is an application designed as a framework for the creation and administration of digital content
 - A *web server* is a software running on a computer that allows locally hosted resources to be viewed and consumed by visitors to a website.
 - *Dynamic* websites are generated server-side
 - An Apache web server exposes HTTP-based resources to external clients and can coordinate internal services
 - A *database engine* is software for managing relational database data using SQL syntax
 - %S2&NkU8v&ho
 - A *network port* is nothing more than a way to identify a particular server resource to network users. Applications can be told to listen for traffic coming to the server when a predetermined port is specified.

 **Summary**
 - Web server packages like Apache coordinate connectivity between system resources such as databases and files, and expose website resources to clients
 - Available software package versions can vary between Linux distributions, and the release version you need can depedn on your specific project
 - Package depedencies can be met with help of search tools and metadata provided by package management systems (like APT and Yum)
 - Applications will often need access to a database engine and will require authentication information

 **Key Terms**
 - A *wiki* is a tool for creating and managing distributed, collaborative projects
 - A *content management system (CMS)* is an application designed to make creating, sharing, and editing digital content
 - A *web server* is software designed to safely and reliably expose server resurces to remote clients
 - *DocumentRoot* is the Apache setting determining where on the file system the web server will look for website files
 - *Structured Query Language (SQL)* is a syntax for managing data in relational databases
 - *Package dependencies* are programs or extensions required for proper function of installed applications

 **Security Best Practices**
 - Ensure your system firewall settings permit appropriate client access to system resources and block everything else
 - Remove root access to your database
 - Never leave a file running `phpinfo` exposed on a public-facing website

 **Command Line Review**
 - `apt install lamp-server^` - installs all the elements of a LAMP server (Ubuntu)
 - `systemctl enable httpd` - launches Apache on a CentOS machine at system boot
 - `firewall-cmd --add-service=http --permanent` - permits HTTP browser traffic into a CentOS system
 - `mysql_secure_installation` - resets your root password and tightens database security
 - `mysql -u root -p` - logs in to MySQL or MariaDB as the root user
 - `CREATE DATABASE newdbname` - creates a new database in MySQL/MariaDB
 - `yum search php- | grep mysql` - searches for available packages related to PHP (CentOS)
 - `apt search mbstring` - searches for available packages related to mulibyte string encoding

## Chapter 8. Networked file sharing: Building a Nextcloud file-sharing server
- Unpacking a .tar.bz2 archive requires the `xjf` arguments

**Summary**
- Planning your data storage strategy requires balancing between cost and ease of use on one side versus security and control on the other
- Ubuntu's snaps are a distribution-neutral package management system that also provide secure, read-only isolation run environments
- In order to know how to route incoming HTTP traffic, Apache reads either multiple host definitions in a single .conf file or multiple host-definition files
- Web servers generally provide resources to visitors using a special web server user account to balance access against system security

**Key Terms**
- A *snap* is a packaged application that can, using `snapd`, be autonomously installed on most Linux distributions
- A `*symbolic link* is a file system object representing a file or directory in a different location. Symbolic links in the /etc/apache2/sites-enabled/ directory point to files in /etc/apache2/sites-available/ that are read by Apache when it starts
- *Archives* can be compressed using the BZ2 algorithm as an alternative to gzip or zip

**Security Best Practices**
- Make sure that all public-facing files from your website are owned by the www-data user rather than the root user
- Keep database resources used by separate applications isolated by creating separate user accounts

**Command-Line Review**
- `a2endmod rewrite` enables the rewrite module so Apache can edit URS as they move between a client and server
- `chown -R www-data:www-data /var/www/nextcloud/` changes the user and group ownership of all website files to the www-data user
- `ln -s /etc/apache2/sites-available/nextcloud.conf /etc/apache2/sites-enabled/nextcloud.conf` creates a symbolic link the /etc/apache2/sites-enabled directory pointing to the nextcloud.conf file in /etc/apache2/sites-available/


## Attribution
Linux in Action by David Clinton, August 2018 - ISBN 9781617294938 